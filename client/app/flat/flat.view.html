<div class="container">
    <div class="row">
        <h2>{{flat.name}}</h2>
    </div>

    <div class="row">
        <div class="col-md-3">
            <h3>Flat info</h3>
            <div ng-if="isFlatAdmin">
                <p>You're this flat's administrator.</p>
            </div>
            <h4 ng-if="users.length > 1">Flat mates:</h4>
            <ul ng-if="users.length > 1">
                <li ng-repeat="user in users">{{ user.mail }}</li>
            </ul>

            <div ng-if="isFlatAdmin">
            <h4>Add new flat mate</h4>

            <div class="form-group" ng-class="{ 'has-error': form.name.$dirty && form.name.$error.required }">
                <form name="flatMateForm" ng-submit="addFlatMate()" role="form">
                    <label for="flatMateMail">New flat mate's e-mail</label>
                    <input type="email" name="flatMateMail" id="flatMateMail" class="form-control"
                    ng-model="newFlatMate.mail" required />
                    <button type="submit" class="btn btn-primary btn-xs" ng-disabled="flatMateForm.$invalid">
                        <i class="fa fa-plus-square" aria-hidden="true"></i> Add flat mate
                    </button>
                </form>
            </div>
            </div>
        </div>
        <div class="col-md-4">
            <h3>Notes</h3>
            <div class="bottom-buffer">
            <button type="button" class="btn btn-primary btn-xs" ng-click="addNote()">
                <i class="fa fa-plus-square" aria-hidden="true"></i> Add
            </button>
            </div>

            <div class="panel panel-default" ng-repeat="note in notes | orderBy:'-date'">
                <div class="panel-heading note-header">
                    <div><i class="fa fa-times with-pointer text-danger" aria-hidden="true"
                    ng-click="removeNote(note)"></i></div>
                </div>
                <div contenteditable ng-model="note.content" ng-blur="updateNote(note)" class="panel-body">
                    {{ note.content }}
                </div>
                <div class="panel-footer text-right">
                    <div>Author: {{ note.author_mail }}</div>
                    <div>Last edited: {{ note.date | date : 'dd.MM.yyyy, H:mm' }}</div>
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <h3>Chores</h3>
            <div class="bottom-buffer">
            <button type="button" class="btn btn-primary btn-xs" ng-click="goToChores()">
                Go to chores panel
            </button>
            </div>


            <h4>To do</h4>
            <table ng-if="choresToDo.length > 0" class="table table-hover table-responsive">
                <thead>
                  <tr>
                    <th>Chore name</th>
                    <th>Due date</th>
                    <th>Responsible</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="chore in choresToDo | limitTo: 4">
                    <td>{{ chore.name }}</td>
                    <td>{{ chore.date * 1000 | date : 'dd.MM.yyyy (EEEE)' }}</td>
                    <td>{{ chore.assigned_mail }}</td>
                  </tr>
                </tbody>
            </table>
            <p ng-if="choresToDo.length == 0">You have no scheduled chores.</p>

            <h4>Recently done</h4>
            <table ng-if="recentlyDoneChores.length > 0" class="table table-hover table-responsive">
                <thead>
                  <tr>
                    <th>Chore name</th>
                    <th>Due date</th>
                    <th>Responsible</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="chore in recentlyDoneChores | limitTo: 4">
                    <td>{{ chore.name }}</td>
                    <td>{{ chore.date * 1000 | date : 'dd.MM.yyyy (EEEE)' }}</td>
                    <td>{{ chore.assigned_mail }}</td>
                  </tr>
                </tbody>
            </table>
            <p ng-if="recentlyDoneChores == 0">You have no recently done chores.</p>
        </div>

    </div>
</div>
